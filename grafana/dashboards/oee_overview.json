{
  "__inputs": [],
  "__requires": [],
  "annotations": { "list": [] },
  "description": "OEEForge — Overall Equipment Effectiveness Overview",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 60 },
              { "color": "green", "value": 85 }
            ]
          },
          "unit": "percent",
          "max": 100,
          "min": 0
        },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 0 },
      "id": 1,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "title": "OEE Score",
      "type": "gauge",
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT time, oee * 100 AS oee FROM oee_metrics WHERE time >= $__timeFrom AND time <= $__timeTo ORDER BY time DESC LIMIT 1",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": {
        "defaults": {
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 70 }, { "color": "green", "value": 90 }] },
          "unit": "percent", "max": 100, "min": 0
        }, "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 0 },
      "id": 2,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"] }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "title": "Availability",
      "type": "gauge",
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT time, availability * 100 AS availability FROM oee_metrics WHERE time >= $__timeFrom AND time <= $__timeTo ORDER BY time DESC LIMIT 1",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": {
        "defaults": {
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 70 }, { "color": "green", "value": 95 }] },
          "unit": "percent", "max": 100, "min": 0
        }, "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 0 },
      "id": 3,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"] }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "title": "Performance",
      "type": "gauge",
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT time, performance * 100 AS performance FROM oee_metrics WHERE time >= $__timeFrom AND time <= $__timeTo ORDER BY time DESC LIMIT 1",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": {
        "defaults": {
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 95 }, { "color": "green", "value": 99 }] },
          "unit": "percent", "max": 100, "min": 0
        }, "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 0 },
      "id": 4,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"] }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "title": "Quality",
      "type": "gauge",
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT time, quality * 100 AS quality FROM oee_metrics WHERE time >= $__timeFrom AND time <= $__timeTo ORDER BY time DESC LIMIT 1",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": {
        "defaults": { "color": { "mode": "palette-classic" }, "custom": { "lineWidth": 2, "spanNulls": false }, "unit": "percent" },
        "overrides": [
          { "matcher": { "id": "byName", "options": "oee" }, "properties": [{ "id": "color", "value": { "fixedColor": "#73BF69", "mode": "fixed" } }, { "id": "custom.lineWidth", "value": 3 }] },
          { "matcher": { "id": "byName", "options": "availability" }, "properties": [{ "id": "color", "value": { "fixedColor": "#5794F2", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "performance" }, "properties": [{ "id": "color", "value": { "fixedColor": "#FF9830", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "quality" }, "properties": [{ "id": "color", "value": { "fixedColor": "#B877D9", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 6 },
      "id": 5,
      "options": { "legend": { "calcs": ["lastNotNull", "max", "min"], "displayMode": "table", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "none" } },
      "title": "OEE Components Over Time",
      "type": "timeseries",
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT time, AVG(oee) * 100 AS oee, AVG(availability) * 100 AS availability, AVG(performance) * 100 AS performance, AVG(quality) * 100 AS quality FROM oee_metrics WHERE time >= $__timeFrom AND time <= $__timeTo GROUP BY time ORDER BY time",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": { "defaults": { "unit": "percent" }, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 },
      "id": 6,
      "options": { "footer": { "show": false }, "showHeader": true },
      "title": "Machines — OEE Summary",
      "type": "table",
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT machine_id, AVG(oee) * 100 AS oee, AVG(availability) * 100 AS availability, AVG(performance) * 100 AS performance, AVG(quality) * 100 AS quality FROM oee_metrics WHERE time >= $__timeFrom AND time <= $__timeTo GROUP BY machine_id ORDER BY oee DESC",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "postgresql" },
      "fieldConfig": { "defaults": { "unit": "s" }, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 14 },
      "id": 7,
      "options": { "footer": { "show": false }, "showHeader": true },
      "title": "Recent Downtime Events",
      "type": "table",
      "targets": [
        {
          "datasource": { "type": "postgres", "uid": "postgresql" },
          "rawSql": "SELECT de.start_time, m.name AS machine, dc.name AS reason, EXTRACT(EPOCH FROM (COALESCE(de.end_time, NOW()) - de.start_time)) AS duration_seconds FROM downtime_events de JOIN machines m ON de.machine_id = m.id LEFT JOIN downtime_codes dc ON de.reason_code_id = dc.id WHERE de.start_time > NOW() - INTERVAL '8 hours' ORDER BY de.start_time DESC LIMIT 50",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "influxdb", "uid": "influxdb3" },
      "fieldConfig": {
        "defaults": { "color": { "mode": "palette-classic" }, "unit": "s" },
        "overrides": [
          { "matcher": { "id": "byName", "options": "running" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "stopped" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "faulted" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 22 },
      "id": 8,
      "title": "Availability Breakdown — State Time by Machine",
      "type": "barchart",
      "options": {
        "barWidth": 0.7,
        "groupWidth": 0.7,
        "orientation": "horizontal",
        "stacking": "normal",
        "legend": { "displayMode": "list", "placement": "bottom" }
      },
      "targets": [
        {
          "datasource": { "type": "influxdb", "uid": "influxdb3" },
          "queryType": "sql",
          "rawSql": "SELECT machine_id, SUM(state_running_seconds) AS running, SUM(state_stopped_seconds) AS stopped, SUM(state_faulted_seconds) AS faulted FROM availability_metrics WHERE time >= $__timeFrom AND time <= $__timeTo GROUP BY machine_id ORDER BY machine_id",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "postgresql" },
      "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 30 },
      "id": 9,
      "title": "Downtime by Reason Code (Last 24h)",
      "type": "piechart",
      "options": { "legend": { "displayMode": "table", "placement": "right" }, "pieType": "donut" },
      "targets": [
        {
          "datasource": { "type": "postgres", "uid": "postgresql" },
          "rawSql": "SELECT dc.name AS reason, COALESCE(SUM(EXTRACT(EPOCH FROM (COALESCE(de.end_time, NOW()) - de.start_time))), 0) / 60 AS minutes FROM downtime_events de LEFT JOIN downtime_codes dc ON de.reason_code_id = dc.id WHERE de.start_time > NOW() - INTERVAL '24 hours' GROUP BY dc.name ORDER BY minutes DESC LIMIT 10",
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "postgresql" },
      "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 30 },
      "id": 10,
      "title": "Reject Events by Reason Code (Last 24h)",
      "type": "piechart",
      "options": { "legend": { "displayMode": "table", "placement": "right" }, "pieType": "donut" },
      "targets": [
        {
          "datasource": { "type": "postgres", "uid": "postgresql" },
          "rawSql": "SELECT COALESCE(dc.name, 'Unknown') AS reason, SUM(re.reject_count) AS total_rejects FROM reject_events re LEFT JOIN downtime_codes dc ON re.reason_code_id = dc.id WHERE re.timestamp > NOW() - INTERVAL '24 hours' GROUP BY dc.name ORDER BY total_rejects DESC LIMIT 10",
          "format": "table",
          "refId": "A"
        }
      ]
    }
  ],
  "refresh": "1m",
  "schemaVersion": 38,
  "tags": ["oee", "manufacturing"],
  "templating": {
    "list": [
      {
        "current": {},
        "datasource": { "type": "postgres", "uid": "postgresql" },
        "definition": "SELECT name FROM machines ORDER BY name",
        "hide": 0,
        "includeAll": true,
        "multi": true,
        "name": "machine",
        "options": [],
        "query": "SELECT name FROM machines ORDER BY name",
        "refresh": 2,
        "sort": 1,
        "label": "Machine",
        "type": "query"
      },
      {
        "current": {},
        "datasource": { "type": "postgres", "uid": "postgresql" },
        "definition": "SELECT name FROM shift_schedules WHERE is_active = true ORDER BY name",
        "hide": 0,
        "includeAll": true,
        "multi": false,
        "name": "shift",
        "options": [],
        "query": "SELECT name FROM shift_schedules WHERE is_active = true ORDER BY name",
        "refresh": 2,
        "sort": 1,
        "label": "Shift",
        "type": "query"
      }
    ]
  },
  "time": { "from": "now-7d", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "OEEForge — OEE Overview",
  "uid": "oeeforge-overview",
  "version": 1
}
